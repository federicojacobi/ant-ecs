(()=>{var n=class{constructor(){this.components=new Map}};var r=class{constructor(){this.entities=[],this.entityPool=[],this.dirtyEntities=[],this.dirtyComponents=[],this.queries=new Map,this.blueprint=new Map,this.componentPool=new Map,this.systems=[]}getNextEntity(){let t;return this.entityPool.lenth>0?t=this.entityPool.pop():t=new n,this.entities.push(t),t}killEntity(t){this.dirtyEntities.push(t)}registerComponent(t){this.blueprint.set(t.type,t)}getNextComponent(t){if(this.componentPool.has(t)&&this.componentPool.get(t).length>0)return this.componentPool.get(t).pop();if(!this.blueprint.has(t))throw new Error(`${t} component is not registered`);return{...this.blueprint.get(t)}}removeComponent(t,e=[]){return Array.isArray(e)?e.forEach(s=>{t.components.delete(s),this.dirtyComponents.push(s)}):(t.components.delete(e),this.dirtyComponents.push(e)),this}addComponent(t,e=[]){return Array.isArray(e)?e.forEach(s=>{t.components.set(s.type,s)}):t.components.set(e.type,e),this}query(t){return this.entities.filter(t)}addSystem(t){if(this.systems.indexOf(t)===-1)return this.systems.push(t),t.ecs=this,t.init(),t;throw new Error("This system already exists")}cleanup(){for(;this.dirtyEntities.length>0;){let t=this.dirtyEntities.pop(),e=this.entities.splice(this.entities.indexOf(t),1)[0];e.components.forEach(s=>{this.dirtyComponents.push(s)}),e.components.clear(),this.entityPool.push(e)}for(;this.dirtyComponents.length>0;){let t=this.dirtyComponents.pop();this.componentPool.has(t.type)||this.componentPool.set(t.type,[]),this.componentPool.get(t.type).push(t)}}update(t){this.systems.forEach(e=>e.update(t)),this.cleanup()}};var h=class{constructor(){this.entities=[],this.entityPool=[],this.dirtyEntities=[],this.dirtyComponents=[],this.queries=new Map,this.blueprint=new Map,this.componentPool=new Map,this.systems=[]}getNextEntity(){let t;return this.entityPool.lenth>0?t=this.entityPool.pop():t=new n,this.entities.push(t),t}killEntity(t){this.dirtyEntities.push(t)}registerComponent(t){this.blueprint.set(t.type,t)}getNextComponent(t){if(this.componentPool.has(t)&&this.componentPool.get(t).length>0)return this.componentPool.get(t).pop();if(!this.blueprint.has(t))throw new Error(`${t} component is not registered`);return{...this.blueprint.get(t)}}removeComponent(t,e=[]){return Array.isArray(e)?e.forEach(s=>{t.components.delete(s),this.dirtyComponents.push(s)}):(t.components.delete(e),this.dirtyComponents.push(e)),this.updateQueries(t),this}addComponent(t,e=[]){return Array.isArray(e)?e.forEach(s=>{t.components.set(s.type,s)}):t.components.set(e.type,e),this.updateQueries(t),this}updateQueries(t){let e=this.queries.keys();for(let s of e){let o=this.queries.get(s),l=o.indexOf(t);s(t)?l===-1&&o.push(t):l>-1&&this.queries.delete(s)}}query(t){if(this.queries.has(t))return this.queries.get(t);let e=this.entities.filter(t);return this.queries.set(t,e),e}addSystem(t){if(this.systems.indexOf(t)===-1)return this.systems.push(t),t.ecs=this,t.init(),t;throw new Error("This system already exists")}cleanup(){for(;this.dirtyEntities.length>0;){let t=this.dirtyEntities.pop(),e=this.entities.splice(this.entities.indexOf(t),1)[0];e.components.forEach(o=>{this.dirtyComponents.push(o)}),e.components.clear(),this.entityPool.push(e);let s=this.queries.keys();for(let o of s)this.queries.get(o).indexOf(t)>-1&&this.queries.delete(o)}for(;this.dirtyComponents.length>0;){let t=this.dirtyComponents.pop();this.componentPool.has(t.type)||this.componentPool.set(t.type,[]),this.componentPool.get(t.type).push(t)}}update(t){this.systems.forEach(e=>e.update(t)),this.cleanup()}};var p=class{init(){}update(t){}destroy(){}};var u={setup(i){return this.ecs=i,this},create(){return this.entity=this.ecs.getNextEntity(),this},addComponent(i,t=null){let e=this.ecs.getNextComponent(i);return this.ecs.addComponent(this.entity,e),t!==null&&Object.assign(e,t),this}};window.AntECS={ECS:h,uECS:r,System:p,scaffold:u};})();
